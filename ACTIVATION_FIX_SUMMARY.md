# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ webapp

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É" –≤ webapp **–Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ Marzban API** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è, –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∞—Å—å.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–µ–ª–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Marzban API.

## üìù –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö API (`api/app/models/schemas.py`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ `ActivateSubscriptionRequest`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ `ActivateSubscriptionResponse`

### 2. –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (`api/app/routes/api.py`)
- ‚úÖ `POST /api/subscription/activate` - —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Marzban
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π subscription URI –∏–∑ Marzban
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### 3. –†–∞—Å—à–∏—Ä–µ–Ω —Å–µ—Ä–≤–∏—Å –ø–æ–¥–ø–∏—Å–æ–∫ (`api/app/services/subscription_service.py`)
- ‚úÖ –ú–µ—Ç–æ–¥ `activate_subscription()` - —Å–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Marzban
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ username –∏–∑ Telegram username –∏–ª–∏ user_id
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ 30 –¥–Ω–µ–π —Å –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–º —Ç—Ä–∞—Ñ–∏–∫–æ–º
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 4. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –≤ MarzbanService (`bot/services/marzban_service.py`)
- ‚úÖ `get_user_subscription()` - –ø–æ–ª—É—á–µ–Ω–∏–µ subscription URL –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ Alias –¥–ª—è `get_user_config()` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å API

### 5. –û–±–Ω–æ–≤–ª–µ–Ω webapp API –∫–ª–∏–µ–Ω—Ç (`webapp/src/lib/api.ts`)
- ‚úÖ –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `activateSubscription()` –¥–ª—è –≤—ã–∑–æ–≤–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### 6. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (`webapp/src/components/ActivationStep.tsx`)
- ‚úÖ –í—ã–∑–æ–≤ –Ω–æ–≤–æ–≥–æ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Marzban –ø–µ—Ä–µ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º URI
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Marzban
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–∫–∞–∑–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### 7. –£–ª—É—á—à–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API (`api/app/main.py`)
- ‚úÖ Startup event –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Marzban API
- ‚úÖ Shutdown event –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

### 8. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API (`api/app/config.py`)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `MARZBAN_ADMIN_TOKEN` –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ username/password
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≥–∏–±–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 9. –£–ª—É—á—à–µ–Ω–∞ –≤–∏–¥–∏–º–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ –≤ webapp
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∫—Ä–∞—Å–∏–≤—ã–π —à—Ä–∏—Ñ—Ç Inter (Google Fonts)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è light/dark —Ä–µ–∂–∏–º–æ–≤
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏

## üöÄ –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏—è

### –ù–æ–≤—ã–π –ø–æ—Ç–æ–∫:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç webapp —á–µ—Ä–µ–∑ Telegram bot
2. –í—ã–±–∏—Ä–∞–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—É (Android, iOS, Windows, etc.)
3. –°–∫–∞—á–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ v2raytun
4. **–ù–∞–∂–∏–º–∞–µ—Ç "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"**
   - üîÑ WebApp –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/subscription/activate`
   - üîÑ API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Marzban
   - üÜï –ï—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ (30 –¥–Ω–µ–π, –±–µ–∑–ª–∏–º–∏—Ç)
   - üîÑ –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –æ–±–Ω–æ–≤–ª—è–µ—Ç (+30 –¥–Ω–µ–π)
   - üì§ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π subscription URI
   - üìã WebApp –∫–æ–ø–∏—Ä—É–µ—Ç URI –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
   - üöÄ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ v2raytun —Å URI
   - ‚úÖ **–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!**

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `/workspace/api/.env`:
```bash
TELEGRAM_BOT_TOKEN=your_bot_token
SECRET_KEY=your_secret_key
MARZBAN_API_URL=https://your-marzban.com/api
MARZBAN_ADMIN_TOKEN=your_marzban_admin_token
ANDROID_APK_URL=...
IOS_APP_STORE_URL=...
MACOS_DMG_URL=...
WINDOWS_EXE_URL=...
ANDROID_TV_APK_URL=...
```

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å MARZBAN_ADMIN_TOKEN:
1. –û—Ç–∫—Ä–æ–π—Ç–µ Marzban –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
2. Settings ‚Üí API Tokens
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π

–ò–ª–∏ —á–µ—Ä–µ–∑ API:
```bash
curl -X POST "https://your-marzban.com/api/admin/token" \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "your_password"}'
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ API:
```bash
cd /workspace/api
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```
üöÄ Starting YoVPN WebApp API...
üì° Marzban API URL: https://your-marzban.com/api
‚úÖ Marzban API is available and ready
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–∫—Ç–∏–≤–∞—Ü–∏—é:
```bash
curl -X POST "http://localhost:8000/api/subscription/activate" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 123456789,
    "platform": "android",
    "telegram_username": "testuser"
  }'
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "message": "Subscription created successfully",
  "subscription_uri": "https://your-marzban.com/sub/testuser",
  "expires_at": "2025-11-20T12:00:00",
  "marzban_username": "testuser"
}
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Marzban:
- –û—Ç–∫—Ä–æ–π—Ç–µ Marzban UI ‚Üí Users
- –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `testuser`
- –£–±–µ–¥–∏—Ç–µ—Å—å: Status Active, +30 –¥–Ω–µ–π, –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ —Ñ–∞–π–ª–µ: [MARZBAN_ACTIVATION_SETUP.md](./MARZBAN_ACTIVATION_SETUP.md)

API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Swagger): http://localhost:8000/docs

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É":
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Marzban
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞—Å—Ç–æ—è—â–∏–π subscription URI
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞–±–æ—á—É—é –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 30 –¥–Ω–µ–π
- ‚úÖ –í–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–∏–º–∞–µ—Ç 2-3 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö mock-–¥–∞–Ω–Ω—ã—Ö!
- ‚úÖ –¢–µ–∫—Å—Ç –≤ webapp —Ö–æ—Ä–æ—à–æ –≤–∏–¥–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Ç–µ–º–∞—Ö

## üéâ –ì–æ—Ç–æ–≤–æ!

–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Marzban API!
